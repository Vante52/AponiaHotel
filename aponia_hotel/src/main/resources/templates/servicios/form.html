<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title
      th:text="${servicio.id} != null ? 'Editar servicio – Aponia' : 'Nuevo servicio – Aponia'"
    >
      Servicio – Aponia
    </title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      h1,
      .brand__name {
        font-family: "Playfair Display", serif;
      }
      .preview-image {
        transition: all 0.3s ease;
        max-height: 0;
        opacity: 0;
        overflow: hidden;
      }
      .preview-image.show {
        max-height: 200px;
        opacity: 1;
      }
    </style>
  </head>

  <body class="bg-white text-[#243444]">
    <!-- Header -->
    <div th:replace="fragments/navbar_admin :: navbar_admin"></div>

    <!-- Main -->
    <main class="max-w-5xl mx-auto px-6">
      <!-- Page head -->
      <div class="pt-7 pb-2">
        <h1
          class="text-3xl text-[#0a3d62] font-semibold mb-1"
          th:text="${servicio.id} != null ? 'Editar servicio' : 'Nuevo servicio'"
        >
          Servicio
        </h1>
        <p class="text-gray-600">Completa los detalles del servicio.</p>
      </div>

      <!-- Card -->
      <div class="bg-white border border-[#e8edf1] rounded-2xl shadow-md">
        <div class="p-5">
          <form
            th:object="${servicio}"
            th:action="${servicio.id} != null ? @{'/servicios/' + ${servicio.id}} : @{/servicios}"
            method="post"
            novalidate
            id="servicioForm"
          >
            <!-- CSRF -->
            <input
              type="hidden"
              th:if="${_csrf != null}"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
            />
            <input type="hidden" th:field="*{id}" />

            <!-- Nombre / Lugar -->
            <div class="grid md:grid-cols-2 gap-4">
              <div class="flex flex-col gap-1">
                <label for="nombre" class="text-sm font-semibold">Nombre</label>
                <input
                  id="nombre"
                  type="text"
                  maxlength="120"
                  placeholder="Ej. Spa & Wellness"
                  th:field="*{nombre}"
                  th:classappend="${#fields.hasErrors('nombre')} ? 'border-red-400 ring-red-200 ring-2' : ''"
                  class="w-full px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
                />
                <div
                  class="text-red-700 text-xs"
                  th:if="${#fields.hasErrors('nombre')}"
                  th:errors="*{nombre}"
                >
                  Error
                </div>
              </div>

              <div class="flex flex-col gap-1">
                <label for="lugar" class="text-sm font-semibold">Lugar</label>
                <input
                  id="lugar"
                  type="text"
                  maxlength="120"
                  placeholder="Ej. Torre principal – Piso 2"
                  th:field="*{lugar}"
                  th:classappend="${#fields.hasErrors('lugar')} ? 'border-red-400 ring-red-200 ring-2' : ''"
                  class="w-full px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
                />
                <div
                  class="text-red-700 text-xs"
                  th:if="${#fields.hasErrors('lugar')}"
                  th:errors="*{lugar}"
                >
                  Error
                </div>
              </div>
            </div>

            <!-- URL de Imagen -->
            <div class="flex flex-col gap-1 mt-4">
              <label for="imagenUrl" class="text-sm font-semibold"
                >URL de Imagen</label
              >
              <input
                id="imagenUrl"
                type="url"
                maxlength="500"
                placeholder="https://ejemplo.com/imagen.jpg"
                class="w-full px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
                oninput="updateImagePreview(this.value)"
              />
              <div class="text-xs text-slate-500">
                Ingresa la URL de la imagen principal para este servicio.
              </div>
            </div>

            <!-- Vista Previa de Imagen -->
            <div id="imagePreview" class="preview-image mt-4">
              <p class="text-sm font-semibold mb-2">Vista previa:</p>
              <img
                id="previewImg"
                src=""
                alt="Vista previa de la imagen"
                class="max-w-full max-h-48 rounded-lg border border-[#e8edf1]"
              />
            </div>

            <!-- Descripción -->
            <div class="flex flex-col gap-1 mt-4">
              <label for="descripcion" class="text-sm font-semibold"
                >Descripción</label
              >
              <textarea
                id="descripcion"
                placeholder="Describe la experiencia, condiciones, etc."
                th:field="*{descripcion}"
                th:classappend="${#fields.hasErrors('descripcion')} ? 'border-red-400 ring-red-200 ring-2' : ''"
                class="w-full min-h-[120px] resize-y px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
              ></textarea>
              <div
                class="text-red-700 text-xs"
                th:if="${#fields.hasErrors('descripcion')}"
                th:errors="*{descripcion}"
              >
                Error
              </div>
            </div>

            <!-- Precio / Duración -->
            <div class="grid md:grid-cols-2 gap-4 mt-4">
              <div class="flex flex-col gap-1">
                <label for="precioPorPersona" class="text-sm font-semibold"
                  >Precio por persona (COP)</label
                >
                <input
                  id="precioPorPersona"
                  type="number"
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                  th:field="*{precioPorPersona}"
                  th:classappend="${#fields.hasErrors('precioPorPersona')} ? 'border-red-400 ring-red-200 ring-2' : ''"
                  class="w-full px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
                />
                <div class="text-xs text-slate-500">
                  Ingresa el valor en pesos colombianos.
                </div>
                <div
                  class="text-red-700 text-xs"
                  th:if="${#fields.hasErrors('precioPorPersona')}"
                  th:errors="*{precioPorPersona}"
                >
                  Error
                </div>
              </div>

              <div class="flex flex-col gap-1">
                <label for="duracionMinutos" class="text-sm font-semibold"
                  >Duración (minutos)</label
                >
                <input
                  id="duracionMinutos"
                  type="number"
                  min="0"
                  step="1"
                  placeholder="Ej. 90"
                  th:field="*{duracionMinutos}"
                  th:classappend="${#fields.hasErrors('duracionMinutos')} ? 'border-red-400 ring-red-200 ring-2' : ''"
                  class="w-full px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
                />
                <div
                  class="text-red-700 text-xs"
                  th:if="${#fields.hasErrors('duracionMinutos')}"
                  th:errors="*{duracionMinutos}"
                >
                  Error
                </div>
              </div>
            </div>

            <!-- Capacidad -->
            <div class="grid md:grid-cols-2 gap-4 mt-4">
              <div class="flex flex-col gap-1">
                <label for="capacidadMaxima" class="text-sm font-semibold"
                  >Capacidad máxima</label
                >
                <input
                  id="capacidadMaxima"
                  type="number"
                  min="1"
                  step="1"
                  placeholder="Ej. 8"
                  th:field="*{capacidadMaxima}"
                  th:classappend="${#fields.hasErrors('capacidadMaxima')} ? 'border-red-400 ring-red-200 ring-2' : ''"
                  class="w-full px-3 py-2 border border-[#e8edf1] rounded-xl focus:outline-none focus:ring-2 focus:ring-[#cfa15a]"
                />
                <div class="text-xs text-slate-500">
                  Opcional. Déjalo vacío si no aplica.
                </div>
                <div
                  class="text-red-700 text-xs"
                  th:if="${#fields.hasErrors('capacidadMaxima')}"
                  th:errors="*{capacidadMaxima}"
                >
                  Error
                </div>
              </div>

              <div
                class="flex flex-col justify-end text-sm text-slate-500 mt-1"
              >
                <!-- Espacio reservado -->
                <div class="h-10">...</div>
              </div>
            </div>

            <!-- Nota sobre imágenes -->
            <div class="mt-4 text-sm text-slate-500">
              Las <strong>imágenes adicionales</strong> se gestionan desde su módulo
              (lista/galería). En la lista se muestra la primera imagen.
            </div>

            <!-- Botones -->
            <div
              class="flex justify-end gap-3 mt-6 pt-4 border-t border-[#e8edf1]"
            >
              <a
                th:href="@{/servicios}"
                class="inline-flex items-center px-4 py-2 border border-[#e8edf1] rounded-xl font-semibold hover:bg-gray-50"
              >
                Cancelar
              </a>
              <button
                type="submit"
                th:text="${servicio.id} != null ? 'Guardar cambios' : 'Crear servicio'"
                class="inline-flex items-center px-4 py-2 rounded-xl font-semibold text-white bg-[#cfa15a] hover:bg-[#b88e4e] shadow"
              >
                Guardar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Espaciado -->
      <div class="h-6"></div>
    </main>

    <script>
      function updateImagePreview(url) {
        const previewContainer = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        
        if (url && isValidUrl(url)) {
          previewImg.src = url;
          previewContainer.classList.add('show');
        } else {
          previewContainer.classList.remove('show');
        }
      }
      
      function isValidUrl(string) {
        try {
          new URL(string);
          return true;
        } catch (_) {
          return false;
        }
      }
      
      // Cargar imagen existente si estamos en modo edición
      document.addEventListener('DOMContentLoaded', function() {
        // Aquí puedes agregar lógica para cargar una imagen existente si estás editando
        // Por ejemplo: if (modoEdicion) { updateImagePreview(urlExistente); }
      });
    </script>
  </body>
</html>