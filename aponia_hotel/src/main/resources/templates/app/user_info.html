<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mi Perfil – Hotel Aponia</title>
    <meta
      name="description"
      content="Edita tu información personal en Hotel Aponia"
    />

    <!-- Tailwind (modo prueba). Pásalo a build en producción) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              aponia: {
                primary: "#0A3D62",
                secondary: "#CFA15A",
                beige: "#F4E3C1",
                neutral: "#F5F5F5",
                white: "#FFFFFF",
              },
            },
            fontFamily: {
              display: ["Playfair Display", "serif"],
              sans: ["Inter", "system-ui", "sans-serif"],
            },
            boxShadow: {
              soft: "0 10px 30px rgba(0,0,0,0.08)",
              lift: "0 12px 40px rgba(10,61,98,0.15)",
            },
          },
        },
      };
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>

  <body class="bg-aponia-neutral text-slate-800 font-sans">
    <!-- Header / Nav -->
    <!-- NAVBAR -->
    <div th:replace="fragments/navbar :: navbar"></div>

    <!-- Main Content -->
    <main class="min-h-screen">
      <!-- Header Section -->
      <section class="py-12 bg-white border-b border-slate-200">
        <div class="mx-auto max-w-4xl px-6">
          <div class="flex items-center gap-4">
            <a
              th:href="@{/home/dashboard}"
              class="p-2 rounded-lg border border-slate-300 hover:bg-slate-50"
              aria-label="Volver"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M15.41 7.41L14 6l-6 6l6 6l1.41-1.41L10.83 12z" />
              </svg>
            </a>
            <div>
              <h1 class="font-display text-2xl md:text-3xl text-aponia-primary">
                Mi Perfil
              </h1>
              <p class="text-slate-600 mt-1">
                Gestiona tu información personal
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Profile Form -->
      <section class="py-12">
        <div class="mx-auto max-w-4xl px-6">
          <div class="mx-auto max-w-4xl px-6">
            <div
              class="bg-white rounded-2xl border border-slate-200 shadow-soft overflow-hidden"
            >
              <!-- Form Header -->
              <div class="px-6 py-5 border-b border-slate-200 flex items-center justify-between">
                <h2 class="font-display text-xl text-aponia-primary">
                  Datos personales
                </h2>
                <!-- Nuevo botón global de editar -->
                <button
                  type="button"
                  onclick="enableEditMode()"
                  id="editProfileBtn"
                  class="px-4 py-2 border border-aponia-primary text-aponia-primary rounded-lg hover:bg-aponia-primary/5 font-medium"
                >
                  Editar perfil
                </button>
              </div>
        
              <!-- Form Content -->
              <form
                id="profileForm"
                class="p-6 space-y-8"
                th:action="@{/home/user_info/{email}(email=${usuario.email})}"
                method="post"
              >
                <!-- Nombre legal -->
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1"
                    >Nombre legal</label
                  >
                  <input
                    type="text"
                    id="nombreLegal"
                    name="nombreCompleto"
                    th:value="${clientePerfil != null ? clientePerfil.nombreCompleto : ''}"
                    class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-aponia-primary/20 focus:border-aponia-primary"
                    readonly
                  />
                </div>
        
                <!-- Email (readonly fijo) -->
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1"
                    >Correo electrónico</label
                  >
                  <input
                    type="email"
                    id="email"
                    name="email"
                    th:value="${usuario.email}"
                    class="w-full px-3 py-2 border border-slate-300 rounded-lg bg-slate-50 text-slate-500"
                    readonly
                  />
                </div>
        
                <!-- Teléfono -->
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1"
                    >Número de teléfono</label
                  >
                  <input
                    type="tel"
                    id="telefono"
                    name="telefono"
                    th:value="${clientePerfil != null ? clientePerfil.telefono : ''}"
                    class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-aponia-primary/20 focus:border-aponia-primary"
                    readonly
                  />
                </div>
        
                <!-- Fecha registro (solo visual) -->
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1"
                    >Fecha de registro</label
                  >
                  <input
                    type="text"
                    id="fechaRegistro"
                    th:value="${clientePerfil != null ? #temporals.format(clientePerfil.fechaRegistro, 'dd/MM/yyyy HH:mm') : ''}"
                    class="w-full px-3 py-2 border border-slate-300 rounded-lg bg-slate-50 text-slate-500"
                    readonly
                  />
                </div>
        
                <!-- Botones de acción -->
                <div
                  id="actionButtons"
                  class="flex flex-col sm:flex-row gap-3 pt-6 border-t border-slate-200 hidden"
                >
                  <button
                    type="submit"
                    class="px-6 py-3 bg-aponia-primary text-white rounded-lg hover:opacity-90 font-medium"
                  >
                    Guardar cambios
                  </button>
                  <button
                    type="button"
                    onclick="cancelChanges()"
                    class="px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium"
                  >
                    Cancelar
                  </button>
                </div>
              </form>
            </div>

          <!-- Configuración de cuenta -->
          <div
            class="mt-8 bg-white rounded-2xl border border-slate-200 shadow-soft overflow-hidden"
          >
            <div class="px-6 py-5 border-b border-slate-200">
              <h2 class="font-display text-xl text-aponia-primary">
                Configuración de cuenta
              </h2>
            </div>
            <div class="p-6 space-y-6">
              <div
                class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
              >
                <div>
                  <h3 class="font-medium text-slate-700">Cambiar contraseña</h3>
                  <p class="text-sm text-slate-500 mt-1">
                    Actualiza tu contraseña para mantener tu cuenta segura
                  </p>
                </div>
                <button
                  type="button"
                  onclick="openPasswordModal()"
                  class="px-4 py-2 border border-aponia-primary text-aponia-primary rounded-lg hover:bg-aponia-primary/5 font-medium whitespace-nowrap"
                >
                  Cambiar
                </button>
              </div>

              <div
                class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 pt-4 border-t border-slate-200"
              >
                <div>
                  <h3 class="font-medium text-red-600">Eliminar cuenta</h3>
                  <p class="text-sm text-slate-500 mt-1">
                    Esta acción no se puede deshacer
                  </p>
                </div>
                <form
                  th:action="@{/home/user_info/{email}/delete(email=${usuario.email})}"
                  method="post"
                >
                  <button
                    type="submit"
                    class="px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 font-medium whitespace-nowrap"
                    onclick="return confirm('¿Eliminar tu cuenta? Esta acción no se puede deshacer.');"
                  >
                    Eliminar
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal: cambiar contraseña -->
    <div
      id="passwordModal"
      class="fixed inset-0 z-50 hidden bg-black/50 backdrop-blur-sm"
    >
      <div class="flex items-center justify-center min-h-full p-4">
        <div
          class="bg-white rounded-2xl border border-slate-200 shadow-lift max-w-md w-full"
        >
          <div
            class="px-6 py-5 border-b border-slate-200 flex items-center justify-between"
          >
            <h3 class="font-display text-xl text-aponia-primary">
              Cambiar contraseña
            </h3>
            <button
              type="button"
              onclick="closePasswordModal()"
              class="p-1 hover:bg-slate-100 rounded-lg"
              aria-label="Cerrar"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-slate-400"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M18.36 19.78L12 13.41l-6.36 6.37-1.42-1.42L10.59 12 4.22 5.64l1.42-1.42L12 10.59l6.36-6.36 1.42 1.42L13.41 12l6.37 6.36z"
                />
              </svg>
            </button>
          </div>

          <form
            id="passwordForm"
            th:action="@{/auth/password}"
            method="post"
            class="p-6 space-y-4"
          >
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1"
                >Contraseña actual</label
              >
              <input
                type="password"
                name="currentPassword"
                required
                class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-aponia-primary/20 focus:border-aponia-primary"
                placeholder="Ingresa tu contraseña actual"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1"
                >Nueva contraseña</label
              >
              <input
                type="password"
                name="newPassword"
                minlength="8"
                required
                class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-aponia-primary/20 focus:border-aponia-primary"
                placeholder="Mínimo 8 caracteres"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-1"
                >Confirmar nueva contraseña</label
              >
              <input
                type="password"
                name="confirmPassword"
                minlength="8"
                required
                class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-aponia-primary/20 focus:border-aponia-primary"
                placeholder="Repite la nueva contraseña"
              />
            </div>
            <div class="flex flex-col sm:flex-row gap-3 pt-4">
              <button
                type="submit"
                class="flex-1 px-6 py-3 bg-aponia-primary text-white rounded-lg hover:opacity-90 font-medium"
              >
                Actualizar contraseña
              </button>
              <button
                type="button"
                onclick="closePasswordModal()"
                class="flex-1 px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200">
      <div class="mx-auto max-w-7xl px-6 py-12 grid gap-8 md:grid-cols-4">
        <div>
          <div class="flex items-center gap-2">
            <img
              src="/img/logo_aponia.png"
              class="h-10 w-10 rounded-lg"
              alt="logo"
            />
            <span class="font-display text-xl text-aponia-primary">Aponia</span>
          </div>
          <p class="mt-4 text-sm text-slate-600">Hotel & Experiencias</p>
        </div>
        <div>
          <h4 class="font-semibold mb-3">Navegación</h4>
          <ul class="space-y-2 text-sm">
            <li>
              <a th:href="@{/#about}" class="hover:text-aponia-primary"
                >Sobre</a
              >
            </li>
            <li>
              <a th:href="@{/habitaciones}" class="hover:text-aponia-primary"
                >Habitaciones</a
              >
            </li>
            <li>
              <a th:href="@{/servicios/cards}" class="hover:text-aponia-primary"
                >Servicios</a
              >
            </li>
            <li>
              <a th:href="@{/#experiences}" class="hover:text-aponia-primary"
                >Experiencias</a
              >
            </li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3">Contacto</h4>
          <ul class="space-y-2 text-sm">
            <li>+57 (000) 000 0000</li>
            <li>
              <a href="mailto:reservas@aponiahotel.com" class="hover:underline"
                >reservas@aponiahotel.com</a
              >
            </li>
            <li>Calle 00 # 00-00, Ciudad</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3">Síguenos</h4>
          <div class="flex gap-3 text-slate-500">
            <!-- Reemplaza por tus iconos -->
            <img src="/img/instagram.png" class="w-8 h-8" alt="Instagram" />
            <img src="/img/facebook.png" class="w-8 h-8" alt="Facebook" />
            <img src="/img/x.png" class="w-8 h-8" alt="X/Twitter" />
          </div>
        </div>
      </div>
      <div
        class="border-t border-slate-200 py-6 text-center text-sm text-slate-600"
      >
        © <span id="year"></span> Aponia. Todos los derechos reservados.
      </div>
    </footer>

    <!-- Scripts -->
    <script>
      // Mobile menu toggle
      const btn = document.getElementById("menuBtn");
      const menu = document.getElementById("mobileMenu");
      btn?.addEventListener("click", () => menu.classList.toggle("hidden"));

      // Year
      document.getElementById("year").textContent = new Date().getFullYear();

      // Store original values for cancel functionality
      let originalValues = {};

  function enableEditMode() {
    const form = document.getElementById("profileForm");
    const inputs = form.querySelectorAll("input");
    const actionButtons = document.getElementById("actionButtons");
    const editBtn = document.getElementById("editProfileBtn");

    // Guardar valores originales
    inputs.forEach((input) => {
      if (input.id !== "email" && input.id !== "fechaRegistro") {
        originalValues[input.id] = input.value;
        input.removeAttribute("readonly");
        input.classList.remove("bg-slate-50", "text-slate-500");
      }
    });

    // Mostrar botones
    actionButtons.classList.remove("hidden");
    editBtn.classList.add("hidden");
  }

  function cancelChanges() {
    const form = document.getElementById("profileForm");
    const inputs = form.querySelectorAll("input");
    const actionButtons = document.getElementById("actionButtons");
    const editBtn = document.getElementById("editProfileBtn");

    // Restaurar valores
    Object.keys(originalValues).forEach((id) => {
      const el = document.getElementById(id);
      if (el) {
        el.value = originalValues[id];
        el.setAttribute("readonly", true);
      }
    });

    // Resetear UI
    actionButtons.classList.add("hidden");
    editBtn.classList.remove("hidden");
    originalValues = {};
  }

      // Modal password
      function openPasswordModal() {
        document.getElementById("passwordModal").classList.remove("hidden");
      }
      function closePasswordModal() {
        document.getElementById("passwordModal").classList.add("hidden");
        document.getElementById("passwordForm").reset();
      }

      // Inicializa estilos de inputs
      document.addEventListener("DOMContentLoaded", function () {
        const inputs = document.querySelectorAll(
          "#profileForm input, #profileForm select"
        );
        inputs.forEach((i) => {
          if (!i.value) i.classList.add("text-slate-500");
        });
      });
    </script>
  </body>
</html>
