<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            aponia: {
              primary: "#0A3D62",
              secondary: "#CFA15A",
              beige: "#F4E3C1",
              neutral: "#F5F5F5",
              white: "#FFFFFF",
            },
          },
          fontFamily: {
            display: ["Playfair Display", "serif"],
            sans: ["Inter", "system-ui", "sans-serif"],
          },
          boxShadow: {
            soft: "0 10px 30px rgba(0,0,0,0.08)",
            lift: "0 12px 40px rgba(10,61,98,0.15)",
          },
        },
      },
    };
  </script>

  <body>
    <header
      th:fragment="navbar"
      class="sticky inset-x-0 top-0 z-50 bg-white/80 backdrop-blur border-b border-slate-200 select-none"
    >
      <div
        class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16"
      >
        <!-- Logo -->
        <a th:href="@{/home/dashboard}" class="flex items-center gap-2">
          <img src="/img/logo_aponia.png" class="h-10 w-10" alt="logo" />
          <span
            class="font-display text-xl tracking-wide text-aponia-primary font-sans"
          >
            Aponia
          </span>
        </a>

        <!-- Links -->
        <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
          <a th:href="@{/servicios/cards}" class="hover:text-aponia-primary">
            Servicios
          </a>
          <a th:href="@{/habitaciones-tipos}" class="hover:text-aponia-primary">
            Habitaciones
          </a>
          <a th:href="@{/experiencias}" class="hover:text-aponia-primary">
            Experiencias
          </a>
          <a th:href="@{/contacto}" class="hover:text-aponia-primary">
            Contacto
          </a>
        </nav>

        <!-- Invitado -->
        <div
          class="hidden md:flex items-center gap-3"
          th:if="${session.AUTH_USER_ID} == null"
        >
          <a
            th:href="@{/login}"
            class="px-4 py-2 rounded-lg border border-aponia-primary text-aponia-primary hover:bg-aponia-primary/5"
          >
            Iniciar sesión
          </a>
          <a
            th:href="@{/registro}"
            class="px-4 py-2 rounded-lg bg-aponia-secondary text-white hover:opacity-90"
          >
            Crear cuenta
          </a>
        </div>

        <!-- Usuario logueado -->
        <div
          class="relative hidden md:block"
          th:if="${session.AUTH_USER_ID} != null"
        >
          <button
            id="userMenuBtn"
            class="w-11 h-11 rounded-full border-2 border-aponia-primary bg-slate-700 text-white flex items-center justify-center font-semibold hover:scale-105 transition overflow-hidden"
          >
            <img
              th:if="${session.AUTH_USER_PHOTO != null}"
              th:src="${session.AUTH_USER_PHOTO}"
              alt="Foto de perfil"
              class="w-full h-full object-cover"
            />
            <span
              th:if="${session.AUTH_USER_PHOTO == null}"
              th:text="${(session.AUTH_USER_NAME != null ? #strings.substring(session.AUTH_USER_NAME,0,1) : #strings.substring(session.AUTH_USER_EMAIL,0,1)).toUpperCase()}"
            >
              U
            </span>
          </button>

          <!-- Dropdown -->
          <div
            id="userMenu"
            class="absolute right-0 mt-2 w-64 bg-white border border-slate-200 rounded-xl shadow-lg hidden"
          >
            <div class="px-4 py-3 border-b border-gray-200">
              <strong
                th:text="${session.AUTH_USER_NAME != null ? session.AUTH_USER_NAME : session.AUTH_USER_EMAIL}"
                class="block text-aponia-primary"
              >
                Usuario
              </strong>
              <small th:text="${session.AUTH_USER_ROLE}" class="text-gray-500">
                ROL
              </small>
            </div>
            <a
              th:href="@{/home/user_info/{email}(email=${session.AUTH_USER_EMAIL})}"
              class="block px-4 py-2 hover:bg-gray-50 rounded-md"
            >
              Mi perfil
            </a>
            <a
              th:href="@{/reservas/mias}"
              class="block px-4 py-2 hover:bg-gray-50 rounded-md"
            >
              Mis reservas
            </a>
            <hr />
            <a
              th:href="@{/logout}"
              class="block px-4 py-2 hover:bg-gray-50 rounded-md"
            >
              Cerrar sesión
            </a>
          </div>
        </div>

        <!-- Botón menú móvil -->
        <button
          id="menuBtn"
          class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg border border-slate-300"
          aria-label="Abrir menú"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            class="h-6 w-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>

      <!-- Menú móvil -->
      <div
        id="mobileMenu"
        class="md:hidden hidden border-t border-slate-200 bg-white"
      >
        <nav class="px-4 py-3 grid gap-3 text-sm">
          <a th:href="@{/servicios/cards}" class="py-2">Servicios</a>
          <a th:href="@{/habitaciones-tipos}" class="py-2">Habitaciones</a>
          <a th:href="@{/experiencias}" class="py-2">Experiencias</a>
          <a th:href="@{/contacto}" class="py-2">Contacto</a>

          <!-- Invitado -->
          <div class="flex gap-2 pt-2" th:if="${session.AUTH_USER_ID} == null">
            <a
              th:href="@{/login}"
              class="flex-1 px-4 py-2 rounded-lg border border-aponia-primary text-aponia-primary text-center"
            >
              Iniciar sesión
            </a>
            <a
              th:href="@{/registro}"
              class="flex-1 px-4 py-2 rounded-lg bg-aponia-secondary text-white text-center"
            >
              Crear cuenta
            </a>
          </div>

          <!-- Usuario logueado -->
          <div
            th:if="${session.AUTH_USER_ID} != null"
            class="flex flex-col gap-2 pt-2"
          >
            <a
              th:href="@{/home/user_info/{email}(email=${session.AUTH_USER_EMAIL})}"
              class="px-4 py-2 rounded-lg border border-slate-300 text-center"
            >
              Mi perfil
            </a>
            <a
              th:href="@{/reservas/mias}"
              class="px-4 py-2 rounded-lg border border-slate-300 text-center"
            >
              Mis reservas
            </a>
            <a
              th:href="@{/logout}"
              class="px-4 py-2 rounded-lg border border-slate-300 text-center"
            >
              Cerrar sesión
            </a>
          </div>
        </nav>
      </div>
    </header>

    <script>
      // Toggle menú usuario
      const userBtn = document.getElementById("userMenuBtn");
      const userMenu = document.getElementById("userMenu");
      if (userBtn) {
        userBtn.addEventListener("click", () => {
          userMenu.classList.toggle("hidden");
        });
      }

      // Toggle menú móvil
      const menuBtn = document.getElementById("menuBtn");
      const mobileMenu = document.getElementById("mobileMenu");
      if (menuBtn) {
        menuBtn.addEventListener("click", () => {
          mobileMenu.classList.toggle("hidden");
        });
      }
    </script>
  </body>
</html>
